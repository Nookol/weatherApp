<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Blah</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="home.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>


</head>

<body onloadstart="render.createBackground()">
<div id="content">
    <div id="weatherRender">
        <!--        <div class="video-container" style="position:absolute;">-->
        <!--            <video autoplay muted loop>-->
        <!--                <source src="videos/clouds.mov" type="video/mp4" />-->
        <!--            </video>-->
        <!--            <div class="caption">-->
        <!--            </div>-->
        <!--        </div>-->
        <h3 id="location"></h3>
        <h1 id="temp"></h1>
        <p>
            <button type="button" id="fButton" onclick="getWeather('f')" class="btn btn-primary">F</button>
            <button type="button" id="cButton" onclick="getWeather('c')" class="btn btn-primary">C</button>
            <button type="button" id="kButton" onclick="getWeather()" class="btn btn-primary">K</button>
        </p>
        <h6 id="description"></h6>
        <div style="margin-top: -15px" id="weatherIcon">
        </div>
        <h6 id="minMax"></h6>
    </div>
    <hr class="solid">
    <div id="quoteRender"></div>
</div>

</body>

<script>

    var opts = {
        lines: 13, // The number of lines to draw
        length: 70, // The length of each line
        width: 10, // The line thickness
        radius: 20, // The radius of the inner circle
        color: '#595858', // #rgb or #rrggbb or array of colors
        speed: 1.25, // Rounds per second
        trail: 85, // Afterglow percentage
        className: 'spinner', // The CSS class to assign to the spinner
    };

    var spinner = new Spinner(opts).spin();
    document.body.append(spinner.el)

    function getQuote() {
        let category = 'happiness'
        $.ajax({
                method: 'GET',
                url: 'https://api.api-ninjas.com/v1/quotes?category=' + category,
                headers: {'X-Api-Key': 'LnjeDenxFbDBi3GeIWsHNQ==hg2QrrJXh4l0JUoS'},
                contentType: 'application/json',
                success: function (result) {
                    console.log(result);
                    let qRender = document.getElementById('quoteRender')
                    qRender.innerHTML = `<h4>"${result[0].quote}" <h6 style="text-align: center">-${result[0].author}</h6></h4>`
                    qRender.innerHTML += `<button type="button" id="quoteButton" onclick="getQuote()" class="btn btn-primary">New Quote</button>`
                },
                error: function ajaxError(jqXHR) {
                    console.error('Error: ', jqXHR.responseText);
                }
            }
        );
    }

    let successHandler = function (position) {
        userData.latitude = position.coords.latitude;
        userData.longitude = position.coords.longitude;
        document.getElementById('content').style.display = 'initial'
        spinner.stop()
        getQuote();
        getWeather('f')
    };

    let errorHandler = function (errorObj) {
        alert(errorObj.code + ": " + errorObj.message);
        userData.latitude = 26.0546106;
        userData.longitude = -98.3939791;
        document.getElementById('content').style.display = 'initial'
        spinner.stop()
        getWeather('f')
    };

    navigator.geolocation.getCurrentPosition(
        successHandler, errorHandler,
        {enableHighAccuracy: true, maximumAge: 10000});


    function kelvinToFahrenheit(kelvin, type, minMax) {
        if (minMax!=='n'){
            if (type === 'f'){
                return `${((kelvin - 273.15) * 9 / 5 + 32).toFixed()}&deg;F`;
            }
            if (type === 'c'){
                return `${(kelvin - 273.15).toFixed()}&deg;C`
            }
            else return `${kelvin.toFixed()}&deg;K`
        }
        if (type === 'f'){
            return `${((kelvin - 273.15) * 9 / 5 + 32).toFixed()}&deg;`;
        }
        if (type === 'c'){
            return `${(kelvin - 273.15).toFixed()}&deg;`
        }
        else return `${kelvin.toFixed()}&deg;`
    }

    let userData = {
        getDate: function () {
            let date = new Date();
            console.log(date.getHours())
            return date;
        },
        latitude: null,
        longitude: null,
        zipCode: null,
        setZipCode: function () {
            this.zipCode = document.getElementById('zip_text_box').value
        }

    }

    let render = {
        createBackground: function () {
            if (userData.getDate().getHours() <= 5) {
            }
            if (userData.getDate().getHours() > 10) {
            }
        }
        ,
        showWeather: function () {
            let location = document.getElementById('location');
            let temp = document.getElementById('temp')
            let desc = document.getElementById('description')
            let minMax = document.getElementById('minMax')
            let icon = document.getElementById('weatherIcon')

            location.innerHTML = weatherData.location;
            temp.innerHTML = `${weatherData.actualTemp}`;
            desc.innerHTML = weatherData.description;
            minMax.innerHTML = `Min ${weatherData.tempLow}\tMax ${weatherData.tempHigh}`
            icon.innerHTML = `<img height="60px" src="https://openweathermap.org/img/wn/${weatherData.icon}@4x.png" alt="weather-logo">`

        }
    }

    let weatherData = {
        actualTemp: null,
        feelsLikeTemp: null,
        location: null,
        description: null,
        tempHigh: null,
        tempLow: null,
        icon: null
    }

    let getWeather = (type) => {
        const options = {
            key: '6c433bc9b94f39c617df099ceedc1db6',
            api: `https://api.openweathermap.org/data/2.5/weather?lat=${userData.latitude}&lon=${userData.longitude}&appid=6c433bc9b94f39c617df099ceedc1db6`,
        };

        fetch(options.api)
            .then(response => response.json())
            .then(data => {
                console.log(data)
                weatherData.location = data.name;
                weatherData.description = data.weather[0].description;
                weatherData.actualTemp = kelvinToFahrenheit(data.main.temp, type)
                weatherData.tempHigh = kelvinToFahrenheit(data.main.temp_max, type , 'n')
                weatherData.tempLow = kelvinToFahrenheit(data.main.temp_min, type, 'n')
                weatherData.feelsLikeTemp = kelvinToFahrenheit(data.main.feels_like, type)
                weatherData.icon = data.weather[0].icon

            })
            .catch(error => console.error(error))
            .finally(load)
    }

    let load = () => {
        render.showWeather()
        console.log(JSON.stringify(weatherData))
    }

</script>
</html>